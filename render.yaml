services:
  # Full Stack Web Application (Frontend + Backend in one service)
  - type: web
    name: feasset
    env: node
    plan: starter
    buildCommand: |
      echo "ğŸš€ Building Full-Stack Web Application..."
      echo "ğŸ“ Current directory:"
      pwd
      echo "ğŸ“ Directory contents:"
      ls -la
      echo "ğŸ“¦ Installing client dependencies..."
      cd client && npm install
      echo "ğŸ—ï¸ Building React frontend..."
      npm run build
      echo "ğŸ“ Checking React build output..."
      ls -la dist/
      echo "ğŸ“ Contents of dist directory:"
      ls -la dist/
      echo "ğŸ“ Creating server/client directory..."
      mkdir -p ../server/client
      echo "ğŸ“ Copying React build to server directory..."
      cp -r dist/* ../server/client/
      echo "ğŸ“ Verifying copy..."
      ls -la ../server/client/
      echo "ğŸ“ Checking for index.html in server/client..."
      ls -la ../server/client/index.html
      echo "ğŸ“ Also copying to server/dist for fallback..."
      cp -r dist/* ../server/dist/
      echo "ğŸ“ Verifying server/dist copy..."
      ls -la ../server/dist/
      echo "ğŸ“¦ Installing server dependencies..."
      cd ../server && npm install
      echo "ğŸ—ï¸ Building Node.js backend..."
      npm run build
      echo "ğŸ—„ï¸ Generating Prisma client..."
      npx prisma generate
      echo "ğŸ“ Final directory structure:"
      find . -name "index.html" -type f
      echo "ğŸ“ Server directory contents:"
      ls -la
      echo "ğŸ“ Server/client directory contents:"
      ls -la client/
      echo "ğŸ“ Server/dist directory contents:"
      ls -la dist/
      echo "âœ… Full-stack build complete!"
    startCommand: |
      echo "ğŸš€ Starting Full-Stack Web Application..."
      cd server
      echo "ğŸ—„ï¸ Setting up database..."
      npx prisma db push --accept-data-loss
      echo "ğŸŒ± Seeding database..."
      npm run db:seed
      echo "ğŸŒ Starting web server..."
      npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 8080
      - key: DATABASE_URL
        fromDatabase:
          name: homestay-db
          property: connectionString
      - key: JWT_SECRET
        generateValue: true
      - key: JWT_REFRESH_SECRET
        generateValue: true
      - key: CORS_ORIGIN
        value: https://feasset.onrender.com

databases:
  - name: homestay-db
    plan: starter
    databaseName: homestay
    user: homestay_user
